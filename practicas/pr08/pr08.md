# Fragmentación

# 2
Se tiene la siguiente red con los MTUs indicados en la misma.

![Alt text](images/image.png)

Si desde pc1 se envía un paquete IP a pc2 con un tamaño total de 1500 bytes (cabecera IP más payload) con el campo Identification = 20543,
responder:

## Indicar IPs origen y destino y campos correspondientes a la fragmentación cuando el paquete sale de pc1
  - origen: 10.0.0.20
  - destino: 10.0.2.20
  - total length: 1500
  - identification: 0xaaaa
  - DF bit (Do not fragment): 0
  - MF bit (More fragments):0
  - Fragment offset: 0
  
## ¿Qué sucede cuando el paquete debe ser reenviado por el router R1?
  - El mtu del R1 es de 600B, como el Total Length es mayor (1500) y el flag DF está en 0, se fragmenta el paquete
  - (si DF fuera 1, se descarta)

## Indicar cómo quedarían las paquetes fragmentados para ser enviados por el enlace entre R1 y R2.

Tamaño max:600
600 - 20 de headers:580
multiplo de 8 mas cercano: 576 de datos (offsetes en unidades de 8 bytes)

576/8 = 72
1152/8 = 144

<!-- el payload debe ser multiplo de 8 , salvo en el ultimo fragmento-->

| num | tamTotal | id     | DF  | MF  | offset |
| --- | -------- | ------ | --- | --- | ------ |
| 1   | 596      | 0xaaaa | 0   | 1   | 0      |
| 2   | 596      | 0xaaaa | 0   | 1   | 72     |
| 3   | 368      | 0xaaaa | 0   | 0   | 144    |

368 = redondeoAMultiplo8Superior(1500-1152 + 20)

<!-- DUDA: el ultimo paquete lleva mf = 0, no?si -->


## ¿Dónde se unen nuevamente los fragmentos? ¿Qué sucede si un fragmento no llega?
<!-- DUDA: es correcto? -->
Los fragmentos se unen en la capa de ip en pc2 

Si se pierde un fragmento,se descarta el datagrama completo y luego es responsabilidad de la capa superior decidir que hacer. En TCP se produce un timeout y se retransmite el datagrama. En UDP no se retransmite.
<!--DUDA: En que momento se descartan los paquetes que llegaron?? en base a un timeout del SO -->

## Si un fragmento tiene que ser reenviado por un enlace con un MTU menor al tamaño del fragmento, ¿qué hará el router con ese fragmento?

Un paquete fragmentado puede volver a fragmentarse.


# Ruteo

# 3. 
## ¿Qué es el ruteo? ¿Por qué es necesario?
El ruteo consiste en buscar y seleccionar la interfaz de salida y el próximo salto, es decir, encontrar un camino entre todos los posibles.

# 4.
## En las redes IP el ruteo puede configurarse en forma estática o en forma dinámica. Indique ventajas y desventajas de cada método.
Estática:
- Las rutas son establecidas por el administrador manualmente
- Propenso a errores
- Si se cambia la topología requiere cambios manuales en los routers
- Sirve cuando se tiene una red sencilla
- No tiene problemas de seguridad ni de incompatibilidad
- No implica costo de procesamiento extra
- Mayor control
- Esquema NO escalable y NO tolerante a fallos

Dinámica: 
- Requiere una configuración inicial por el administrador
- Si se cambia la topología se adapta de forma automática
- Facilita mantenimiento cuando se tiene una red compleja
- Implica costo de procesamiento extra
- Esquema escalable y tolerante a fallos
- Resolución de Problemas/Debugging, más complejo
- Caminos “óptimos” de acuerdo a la información manejada por el protocolo (métrica, costo)


# 5.
## Una máquina conectada a una red pero no a Internet, ¿tiene tabla de ruteo?
Si, la tabla de ruteo es necesaria para poder comunicar los dispositivos de la red.


<!-- Duda: que significa que no esté conectada a internet?
¿ que no posee ninguna interfaz conectada a la red de internet con ip pública?
 -->

# 6.
Observando el siguiente gráfico y la tabla de ruteo del router D, responder:

![Alt text](images/image-1.png)

## a.
¿Está correcta esa tabla de ruteo? 
En caso de no estarlo, indicar el o los errores encontrados.
Escribir la tabla correctamente (no es necesario agregar las redes que conectan contra los ISPs)

<!-- rta: -->
<!-- DUDA: ESTA OK? FALTA ALGUNO? -->
Errores:
- falta configurar para red 10.0.0.8/30 sin next-hop con Iface eth3
- 10.0.0.12 tiene mal Next-hop: va sin máscara /30
- 205.10.128.0 (red a): no se encuentra esta dirección en ninguna red
  - se cambia por 205.10.0.128 (red a) pero: Next-Hop está mal configurado (10.0.0.2 es ip de Rtr-D), debería ser 10.0.0.1 eth5
- 205.20.0.193/26: no existe esa red. Debería ser:  205.20.0.192/26 , 10.0.0.5, eth5


## b.
Con la tabla de ruteo del punto anterior, Red D, ¿tiene salida a Internet? ¿Por qué? ¿Cómo lo solucionaría? Suponga que los demás routers están correctamente configurados, con salida a Internet y que Rtr-D debe salir a Internet por Rtr-C.

<!-- rta: -->
<!-- DUDA: OK? -->
No tiene salida a internet porque no se configuro el ruteo a la red 120.0.0.0/30 o 130.0.10.0/30

Lo solucionaria agregando a la tabla de rutas:

| Destino    | Mask | Next-hop  | Iface |
| ---------- | ---- | --------- | ----- |
| 130.0.10.0 | /30  | 10.0.0.10 | eth3  |


## c.
Teniendo en cuenta lo aplicado en el punto anterior, si en Rtr-C estuviese la siguiente entrada en su tabla de ruteo, ¿qué sucedería si desde una PC en Red D se quiere acceder un servidor con IP 163.10.5.15?
| Destino    | Mask | Next-hop | Iface |
| ---------- | ---- | -------- | ----- |
| 163.10.5.0 | /24  | 10.0.0.9 | eth1  |
<!-- rta -->

<!-- Duda: ok?? -->
No llegaría al servidor ya que iría por una ruta default hasta el Rtr-C y éste lo rutearía de vuelta al router Rtr-D y comenzaría un loop de ruteo entre los 2 routers.


## d.
¿Es posible aplicar sumarización en esa tabla, la del router Rtr-D? ¿Por qué? ¿Qué debería suceder
para poder aplicarla?

La sumarización es unificar varias redes individuales en una sola entrada de ruteo.

Se podria sumarizar las siguientes redes si no tuvieran diferente interfaz:
10.0.0.0/30
10.0.0.4/30
10.0.0.8/30
10.0.0.12/30
10.0.0.16/30

10.0.0.000|00100
..
10.0.0.000|10000

10.0.0.0/27

como tienen direrente interfaz, la unicas redes que se pueden sumarizar son:

<!-- duda:ok?? no-->
<!-- o solo es:
10.0.0.12/30
10.0.0.16/30
?? ya que 10.0.0.8 está directamente conectada al router?
-->
10.0.0.8/30
10.0.0.12/30
10.0.0.16/30

10.0.0.000|01000
..
10.0.0.000|10000

10.0.0.0/27


| Destino  | Mask | Next-hop | Iface |
| -------- | ---- | -------- | ----- |
| 10.0.0.0 | /27  | -        | eth1  |

<!--  lo que se puede sumarizar es la red B y la E-->

## e.
La sumarización aplicada en el punto anterior, ¿se podría aplicar en Rtr-B? ¿Por qué?

no se puede sumarizar, porque es la que debe diferenciarlas y redireccionarlas por diferentes interfaces

## f.
Escriba la tabla de ruteo de Rtr-B teniendo en cuenta lo siguiente:
- Debe llegarse a todas las redes del gráfico
- Debe salir a Internet por Rtr-A
- Debe pasar por Rtr-D para llegar a Red D <!--duda: puede llegar a red D sin pasar por Rtr-D?? -->
- Sumarizar si es posible

| Destino       | Mask | Next-hop  | Iface |
| ------------- | ---- | --------- | ----- |
| 205.20.0.192  | /26  | -         | eth0  | red B                                    |
| 205.20.0.128  | /26  | -         | eth2  | red E                                    |
| 10.0.0.4      | /30  | -         | eth1  | <!-- DUDA:es necesario? -->              |
| 10.0.0.12     | /30  | -         | eth03 | idem arriba?                             |
| 153.10.20.128 | /27  | 10.0.0.6  | eth1  | red D                                    |
| 205.10.0.128  | /25  | 10.0.0.13 | eth3  | red A                                    |
| 0.0.0.0       | /0   | 10.0.0.13 | eth3  | <!-- default ok?sale por internet aca--> |
| 163.10.5.64   | /27  | 10.0.0.6  | eth1  | red C                                    |


<!--duda: sumarizacion?? -->

## g.
Si Rtr-C pierde conectividad contra ISP-2, ¿es posible restablecer el acceso a Internet sin esperar a que vuelva la conectividad entre esos dispositivos?

<!-- Duda:ok?? -->
Si, derivando el trafico a Rtr A y que Rtr A tenga como default gateway la ip a ISP-1

# 7.
Evalúe para cada caso si el mensaje llegará a destino, saltos que tomará y tipo de respuesta recibida el emisor.

![Alt text](images/image-2.png)

- Un mensaje ICMP enviado por PC-B a PC-C.
  - 
- Un mensaje ICMP enviado por PC-C a PC-B.
  - 
- Un mensaje ICMP enviado por PC-C a 8.8.8.8.
  - 
- Un mensaje ICMP enviado por PC-B a 8.8.8.8.



# DHCP y NAT


# 8.
Con la máquina virtual con acceso a Internet realice las siguientes observaciones respecto de la autoconfiguración IP vía DHCP:

## a. Inicie una captura de tráfico Wireshark utilizando el filtro bootp para visualizar únicamente tráfico de DHCP.


## b. En una terminal de root, ejecute el comando sudo /sbin/dhclient eth0 y analice el intercambio de paquetes capturado.
usé: sudo /sbin/dhclient enp0s3

0.0.0.0	255.255.255.255	DHCP	342	DHCP Request  - Transaction ID 0xeb80ef5f
10.0.2.2	10.0.2.15	DHCP	590	DHCP ACK      - Transaction ID 0xeb80ef5f

## c. Analice la información registrada en el archivo /var/lib/dhcp/dhclient.leases, ¿cuál parece su función?
Se guardan los datos del servidor DHCP, es decir, es una base de datos persistente de todas las conexiones que son válidas.
Si una conexión esta dos veces se toma el ultimo.

O sea, guarda las direcciones ip "alquiladas", con el tiempo de validez incluido

## d. Ejecute el siguiente comando para eliminar información temporal asignada por el servidor DHCP. rm /var/lib/dhcp/dhclient.leases
listo

## e. En una terminal de root, vuelva a ejecutar el comando sudo /sbin/dhclient eth0 y analice el intercambio de paquetes capturado nuevamente ¿a que se debió la diferencia con lo observado en el punto “b”?
<!-- DUDA: que diferencia deberia haber? no noté ninguna diferencia -->

0.0.0.0	255.255.255.255	DHCP	342	DHCP Discover - Transaction ID 0xe17f3f0b
10.0.2.2	10.0.2.15	DHCP	590	DHCP Offer    - Transaction ID 0xe17f3f0b
0.0.0.0	255.255.255.255	DHCP	342	DHCP Request  - Transaction ID 0xe17f3f0b
10.0.2.2	10.0.2.15	DHCP	590	DHCP ACK      - Transaction ID 0xe17f3f0b

## f. Tanto en “b” como en “e”, ¿qué información es brindada al host que realiza la petición DHCP, además de la dirección IP que tiene que utilizar?

Su dirección IP asignada
Cantidad de segundos que le presta la ip
Máscara de subred
Dirección IP de broadcast
Dirección IP del router
Dirección IP del DNS local
Dirección IP del servidor DHCP


# 9.
¿Qué es NAT y para qué sirve? De un ejemplo de su uso y analice cómo funcionaría en ese entorno.
Ayuda: analizar el servicio de Internet hogareño en el cual varios dispositivos usan Internet simultáneamente.


(Network Address Translator)
Es la Traduccion de direcciones de un espacio privado (no “enrutable” en Internet) a un espacio público.

Se encarga de traducir una dirección IP privada a una dirección IP pública o viceversa. Se usa cuando necesitamos que nuestros dispositivos en la red (con IP privadas) se comuniquen a través de internet.

Puede ser NAT basico o NAPT (Network Address Port Translation)

- NAT basico: es “one-to-one”. Mapea una IPv4 privada a una publica y visceversa.
  - Estático: requiere tantas direcciones públicas como privadas
  - Dinámico: no requiere tantas direcciones públicas como privadas, pero sí se requiere un timer por cada entrada. Limita acceso simultaneo de acuerdo al pool pub.
- NAPT: es “one-to-many”. 
  - Permite que varias IP privadas se conecten a internet utilizando una única IP pública. Destacando que en este caso la traducción se realiza usando puertos.
  - En la tabla se mantiene el protocolo y el puerto origen y destino. Se intenta conservar el puerto origen, pero si esta “ocupado” se debe reemplazar por otro.




# 10.
¿Qué especifica la RFC 1918 y cómo se relaciona con NAT?

# 11.
En la red de su casa o trabajo verifique la dirección IP de su computadora y luego acceda a www.cualesmiip.com. ¿Qué observa? ¿Puede explicar qué sucede?